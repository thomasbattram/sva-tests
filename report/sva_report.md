# Assessing the best practice for surrogate variable analysis in epigenome-wide association studies






```
## Error: '~/sva_tests/results/ncpg_comp_10_sims.txt' does not exist.
```





## Aim:
To test the length of time taken to generate surrogate variables (SVs) using various different parameters and compare the SVs generated

## Methods:

### Data
Used the 450k data from ALSPAC mothers (timepoint = FOM, n = `r `). This is DNA methylation measured in whole blood samples. All CpGs were used for analysis. 

Phenotype data was simulated using the rnorm() function in R.

### Analysis
__Parameters tested:__
* SVA package - sva and smartsva
* Number of CpGs - increasing from 20,000 to 300,000 by increments of 20,000 + the full set of CpGs (`r`)
	+ And whether subsetting the CpGs to the most variable CpGs or a random set works best 
* Number of SVs - just comparison between using 10 and 20 SVs
* Number of samples - increasing from 100 to 900 by increments of 100

__SVA package:__
Time taken to run the analyses was compared as were the SVs generated by assessing the Pearsons correlation between SVs and how much of the variance of the SV generated by the sva package was explained by the same SV generated from the smartsva package.

We set the input parameters to be identical. These parameters were as follows:
* 
* 
* 

__Number of CpGs:__
Time taken to run the analyses and the SVs generated by subsets of CpGs were compared to the same factors when running the analyses using all CpGs on the 450k array. To compare the SVs we took each of the SVs generated using all CpGs on the 450k array and calculated the variance of each of these SVs explained by all the SVs generated using the subset of CpGs. i.e:

$$SVi ~ SV1' + SV2' + ... + SV20'$$

where _SVi_ is the ith SV generated using all CpGs from the 450k array. 

For the number of SVs and the number of samples we just assessed run time...
__Assess something else as well as run time for number of SVs???__ 

## Results

### Timings

![Figure 1: How does time taken to perform SVA vary with sample number, SVA package and CpG number?](figure/time_plot-1.png)


----------------------------------------------------------------------------
 n_sv   sv_type    n_cpg     dat_type    n_sample   time_user   time_system 
------ ---------- -------- ------------ ---------- ----------- -------------
  20    smartsva   20000    continuous     900        17.6         0.344    

  20    smartsva   40000    continuous     900        35.23        0.989    

  20    smartsva   60000    continuous     900        54.27        10.61    

  20    smartsva   80000    continuous     900        68.73        3.858    

  20    smartsva   1e+05    continuous     900        89.61        8.477    

  20    smartsva   120000   continuous     900        107.9        3.244    

  20    smartsva   140000   continuous     900        128.6        2.868    

  20    smartsva   160000   continuous     900        146.4        10.04    

  20    smartsva   180000   continuous     900        163.3        15.7     

  20    smartsva   2e+05    continuous     900        180.7        21.16    

  20    smartsva   220000   continuous     900         195         15.25    

  20    smartsva   240000   continuous     900        215.8        11.09    

  20    smartsva   260000   continuous     900        234.9        18.59    

  20    smartsva   280000   continuous     900         251         14.98    

  20    smartsva   3e+05    continuous     900        265.6        21.71    

  20    smartsva   483103   continuous     900         451         29.42    

  20      sva      483103   continuous     900        1703         302.2    

  20    smartsva   483103   continuous     900         451         29.42    

  20    smartsva   483103   continuous     100        22.15        1.097    

  20    smartsva   483103   continuous     200        42.66        1.985    

  20    smartsva   483103   continuous     300        71.58        2.485    

  20    smartsva   483103   continuous     400        109.5        6.403    

  20    smartsva   483103   continuous     500        154.1        8.969    

  20    smartsva   483103   continuous     600        213.8        13.71    

  20    smartsva   483103   continuous     700        283.8        17.91    

  20    smartsva   483103   continuous     800        352.8        65.24    

  20    smartsva   483103   continuous     900         451         29.42    
----------------------------------------------------------------------------

Table: Table continues below

 
--------------
 time_elapsed 
--------------
    17.94     

    36.21     

    64.88     

    72.58     

    98.08     

    111.2     

    131.4     

    156.4     

     179      

    201.9     

    210.2     

    226.9     

    253.5     

     266      

    287.3     

    480.3     

    526.2     

    480.3     

    23.25     

    44.64     

    74.05     

    115.9     

     163      

    227.5     

    301.6     

    418.2     

    480.3     
--------------

### Smart vs normal sva

-------------------
 sv   cor   adj_r2 
---- ----- --------
 1     1      1    

 2     1      1    

 3     1      1    

 4     1      1    

 5    -1      1    

 6     1      1    

 7    -1      1    

 8     1      1    

 9     1      1    

 10    1      1    

 11   -1      1    

 12    1      1    

 13   -1      1    

 14    1      1    

 15   -1      1    

 16    1      1    

 17    1      1    

 18    1      1    

 19   -1      1    

 20   -1      1    
-------------------

### Effectiveness of subseting CpGs
![Figure 2: Is it better to subset the number of CpGs randomly or by most variable CpGs when running SVA?](figure/mv_vs_random-1.png)

![Figure 3: Variance captured of SVs made using 450k CpGs compared to random subsets](figure/ncpg_plot-1.png)












